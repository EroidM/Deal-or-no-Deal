<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sales & Marketing Dashboard</title>
    <!-- CSS for Font Awesome - still using CDN as it's not a direct npm dependency we installed for this purpose -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">

    <!-- Local CSS for Flatpickr from node_modules -->
    <link rel="stylesheet" href="{{ url_for('node_modules_bp.static', filename='flatpickr/dist/flatpickr.min.css') }}">
    <!-- Local CSS for FullCalendar Core from node_modules -->
    <link rel="stylesheet" href="{{ url_for('node_modules_bp.static', filename='@fullcalendar/core/main.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('node_modules_bp.static', filename='@fullcalendar/daygrid/main.min.css') }}">

    <style>
        /* Modern, Space-centric Styling */
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --background-light: #f4f7f6;
            --card-background: #ffffff;
            --text-dark: #343a40;
            --text-muted: #6a7482;
            --border-color: #e0e6ed;
            --shadow-light: rgba(0, 0, 0, 0.08);
            --font-family: 'Inter', sans-serif; /* Using Inter as per guidelines */
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--background-light);
            color: var(--text-dark);
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        header {
            background-color: var(--card-background);
            color: var(--text-dark);
            padding: 1rem 2rem;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow-light);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
        }

        header h1 {
            margin: 0;
            font-size: 1.8rem;
            color: var(--primary-color);
        }

        .dashboard-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            padding: 1.5rem;
            max-width: 1400px;
            margin: 1.5rem auto;
            flex-grow: 1; /* Allow container to grow and take available space */
        }

        .card {
            background-color: var(--card-background);
            padding: 1.5rem;
            border-radius: 12px; /* More rounded corners */
            box-shadow: var(--shadow-light);
            display: flex;
            flex-direction: column;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            position: relative; /* For loading overlay */
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: rgba(0, 0, 0, 0.15) 0px 8px 24px;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-header h2 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--text-dark);
        }

        .card-content {
            flex-grow: 1; /* Allow content to take available height */
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .stat-item {
            background-color: var(--background-light);
            padding: 1rem;
            border-radius: 8px;
            text-align: center;
            box-shadow: rgba(0, 0, 0, 0.05) 0px 1px 2px 0px;
        }

        .stat-item h3 {
            margin: 0 0 0.5rem 0;
            font-size: 1rem;
            color: var(--text-muted);
        }

        .stat-item p {
            margin: 0;
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-item.new p { color: var(--info-color); }
        .stat-item.qualified p { color: var(--warning-color); }
        .stat-item.won p { color: var(--success-color); }
        .stat-item.lost p { color: var(--danger-color); }


        .button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap; /* Allow buttons to wrap */
        }

        .btn {
            padding: 0.75rem 1.25rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: background-color 0.2s ease, transform 0.1s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #0056b3;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-secondary:hover {
            background-color: #5a6268;
            transform: translateY(-2px);
        }

        .table-responsive {
            overflow-x: auto;
            margin-top: 1rem;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            white-space: nowrap; /* Prevent text wrapping in cells */
        }

        table thead th {
            background-color: var(--background-light);
            padding: 0.8rem 1rem;
            text-align: left;
            font-size: 0.85rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            border-bottom: 1px solid var(--border-color);
        }

        table tbody td {
            padding: 0.8rem 1rem;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle; /* Align content vertically */
        }

        table tbody tr:last-child td {
            border-bottom: none;
        }

        table tbody tr:hover {
            background-color: #f0f3f6;
        }

        table tbody td button {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            margin: 0 0.2rem;
            padding: 0.3rem;
            border-radius: 4px;
            transition: background-color 0.2s ease;
        }

        table tbody td button:hover {
            background-color: rgba(0, 0, 0, 0.05);
        }

        /* Responsive table behavior */
        @media screen and (max-width: 768px) {
            table thead {
                display: none; /* Hide table headers on small screens */
            }

            table, table tbody, table tr, table td {
                display: block; /* Make table elements behave like block elements */
                width: 100%;
            }

            table tr {
                margin-bottom: 1rem;
                border: 1px solid var(--border-color);
                border-radius: 8px;
                overflow: hidden; /* For rounded corners */
            }

            table tbody td {
                text-align: right;
                padding-left: 50%; /* Space for the pseudo-element label */
                position: relative;
            }

            table tbody td::before {
                content: attr(data-label); /* Use data-label for the pseudo-element */
                position: absolute;
                left: 10px;
                width: calc(50% - 20px);
                text-align: left;
                font-weight: bold;
                color: var(--text-dark);
            }
        }

        .chart-container {
            position: relative;
            height: 250px; /* Fixed height for chart */
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .chart-container canvas {
            max-height: 100%;
            max-width: 100%;
        }

        .list-group {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .list-group-item {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            font-size: 0.9rem;
        }

        .list-group-item:last-child {
            border-bottom: none;
        }

        .list-group-item .lead-name {
            font-weight: bold;
            color: var(--primary-color);
        }

        .list-group-item .followup-details {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Modal Styles */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 1000;
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background-color: var(--card-background);
            padding: 2rem;
            border-radius: 12px;
            box-shadow: rgba(0, 0, 0, 0.2) 0px 10px 30px;
            width: 90%;
            max-width: 600px;
            transform: translateY(-20px);
            transition: transform 0.3s ease;
            position: relative;
            max-height: 90vh; /* Limit height for scrollable content */
            overflow-y: auto; /* Enable scrolling for long forms */
        }

        .modal.active .modal-content {
            transform: translateY(0);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 1rem;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-muted);
            transition: color 0.2s ease;
        }

        .close-btn:hover {
            color: var(--danger-color);
        }

        .form-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 1rem;
        }

        @media (min-width: 600px) {
            .form-grid {
                grid-template-columns: 1fr 1fr; /* Two columns on larger screens */
            }
            .form-group.full-width {
                grid-column: span 2; /* Make this group span both columns */
            }
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-dark);
            font-size: 0.95rem;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group input[type="tel"],
        .form-group input[type="date"],
        .form-group input[type="number"],
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-family: var(--font-family);
            font-size: 1rem;
            box-sizing: border-box; /* Include padding in width */
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.25);
            outline: none;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .modal-content .btn-primary {
            width: 100%;
            margin-top: 1.5rem;
        }

        /* FullCalendar specific styles */
        .fc .fc-button-primary {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            border-radius: 8px;
            transition: background-color 0.2s ease;
        }

        .fc .fc-button-primary:hover {
            background-color: #0056b3;
            border-color: #0056b3;
        }

        .fc .fc-button-primary:not(:disabled).fc-button-active {
            background-color: #004085;
            border-color: #004085;
        }

        .fc-event {
            border-radius: 4px;
            padding: 2px 4px;
            font-size: 0.85em;
            cursor: pointer;
            border: 1px solid transparent; /* default */
        }

        /* Event type specific colors */
        .fc-event-call { background-color: #17a2b8; border-color: #17a2b8; color: white; } /* Info color */
        .fc-event-email { background-color: #ffc107; border-color: #ffc107; color: #343a40; } /* Warning color */
        .fc-event-meeting { background-color: #28a745; border-color: #28a745; color: white; } /* Success color */
        .fc-event-cold-visit { background-color: #dc3545; border-color: #dc3545; color: white; } /* Danger color */
        /* Add more as needed */

        /* Calendar Tooltip */
        .calendar-tooltip {
            position: absolute;
            background-color: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 0.85rem;
            pointer-events: none; /* Allows clicks to pass through */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            z-index: 1001; /* Above modals */
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .calendar-tooltip.active {
            opacity: 1;
            visibility: visible;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000; /* Higher than modals */
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
        }

        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .spinner {
            border: 6px solid #f3f3f3;
            border-top: 6px solid var(--primary-color);
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Message Container */
        .message-container {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0.3s ease;
            z-index: 2001; /* Higher than loading overlay */
            min-width: 250px;
            text-align: center;
        }

        .message-container.active {
            opacity: 1;
            visibility: visible;
        }

        .message-container.success { background-color: var(--success-color); }
        .message-container.error { background-color: var(--danger-color); }
        .message-container.info { background-color: var(--info-color); }

        /* Footer */
        footer {
            text-align: center;
            padding: 1rem;
            margin-top: 2rem;
            color: var(--text-muted);
            font-size: 0.85rem;
            border-top: 1px solid var(--border-color);
            background-color: var(--card-background);
        }

        /* Specific styles for the filter section in expenditure report */
        .filter-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap; /* Allow wrapping on smaller screens */
            align-items: flex-end; /* Align items to the bottom */
        }

        .filter-controls .form-group {
            margin-bottom: 0; /* Remove bottom margin from form groups within filter controls */
            flex-grow: 1; /* Allow date inputs to grow */
            min-width: 150px; /* Ensure date inputs don't get too small */
        }

        .filter-controls .btn {
            flex-shrink: 0; /* Prevent buttons from shrinking */
        }

        .expenditure-summary {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--text-dark);
            margin-top: 1.5rem;
            text-align: right;
            padding-right: 1rem;
        }

    </style>
</head>
<body>
    <header>
        <h1>Sales & Marketing Dashboard</h1>
        <nav>
            <!-- Navigation links can go here if needed -->
        </nav>
    </header>

    <div class="dashboard-container">
        <!-- Leads Overview Card -->
        <div class="card">
            <div class="card-header">
                <h2>Leads Overview</h2>
                <button class="btn btn-primary" id="addLeadModalBtn"><i class="fas fa-plus"></i> Add Lead</button>
            </div>
            <div class="card-content">
                <div class="stats-grid">
                    <div class="stat-item">
                        <h3>Total Leads</h3>
                        <p id="totalLeadsCount">0</p>
                    </div>
                    <div class="stat-item new">
                        <h3>New Leads</h3>
                        <p id="newLeadsCount">0</p>
                    </div>
                    <div class="stat-item qualified">
                        <h3>Qualified Leads</h3>
                        <p id="qualifiedLeadsCount">0</p>
                    </div>
                    <div class="stat-item won">
                        <h3>Closed Won</h3>
                        <p id="closedWonLeadsCount">0</p>
                    </div>
                    <div class="stat-item lost">
                        <h3>Closed Lost</h3>
                        <p id="closedLostLeadsCount">0</p>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="leadsByStageChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Recent Leads Card -->
        <div class="card">
            <div class="card-header">
                <h2>Recent Leads</h2>
                <button class="btn btn-secondary" id="exportLeadsBtn"><i class="fas fa-file-export"></i> Export Leads</button>
            </div>
            <div class="card-content">
                <div class="table-responsive">
                    <table id="recentLeadsTable">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Company</th>
                                <th>Stage</th>
                                <th>Contact Date</th>
                                <th>Follow-up Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Lead data will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Upcoming Follow-ups Card -->
        <div class="card">
            <div class="card-header">
                <h2>Upcoming Follow-ups</h2>
            </div>
            <div class="card-content">
                <ul class="list-group" id="upcomingFollowupsList">
                    <!-- Upcoming follow-ups will be loaded here by JavaScript -->
                    <li>No upcoming follow-ups.</li>
                </ul>
            </div>
        </div>

        <!-- Planning Calendar Card -->
        <div class="card">
            <div class="card-header">
                <h2>Planning Calendar</h2>
                <button class="btn btn-primary" id="addEventModalBtn"><i class="fas fa-calendar-plus"></i> Add Event</button>
            </div>
            <div class="card-content">
                <div id="calendar" style="height: 400px;"></div>
            </div>
        </div>

        <!-- Expenditure Report Card -->
        <div class="card full-width">
            <div class="card-header">
                <h2>Expenditure Report</h2>
                <div class="button-group">
                    <button class="btn btn-primary" id="addExpenseModalBtn"><i class="fas fa-plus"></i> Add Expense</button>
                    <button class="btn btn-secondary" id="exportExpenditureReportBtn"><i class="fas fa-file-export"></i> Export Report</button>
                </div>
            </div>
            <div class="card-content">
                <div class="filter-controls">
                    <div class="form-group">
                        <label for="reportStartDate">Start Date:</label>
                        <input type="date" id="reportStartDate">
                    </div>
                    <div class="form-group">
                        <label for="reportEndDate">End Date:</label>
                        <input type="date" id="reportEndDate">
                    </div>
                    <button class="btn btn-primary" id="filterReportBtn"><i class="fas fa-filter"></i> Filter</button>
                    <button class="btn btn-secondary" id="clearReportDatesBtn"><i class="fas fa-times"></i> Clear Dates</button>
                </div>
                <div class="table-responsive">
                    <table id="expenditureReportTable">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount (KSh)</th>
                                <th>Lead Name</th>
                                <th>Company</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="expenditureReportTableBody">
                            <!-- Expenditure data will be loaded here by JavaScript -->
                        </tbody>
                    </table>
                </div>
                <div class="expenditure-summary" id="totalExpenditureSummary">
                    Total Expenditure: KSh 0.00
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>&copy; 2025 Sales & Marketing Dashboard. All rights reserved.</p>
    </footer>

    <!-- Modals -->

    <!-- Lead Modal -->
    <div id="leadModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add New Lead</h2>
                <button class="close-btn" id="closeLeadModalBtn">&times;</button>
            </div>
            <form id="addLeadForm">
                <input type="hidden" id="leadId" name="id"> <!-- Hidden input for lead ID -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="firstName">First Name:</label>
                        <input type="text" id="firstName" name="firstName" required>
                    </div>
                    <div class="form-group">
                        <label for="lastName">Last Name:</label>
                        <input type="text" id="lastName" name="lastName">
                    </div>
                    <div class="form-group">
                        <label for="title">Title:</label>
                        <input type="text" id="title" name="title">
                    </div>
                    <div class="form-group">
                        <label for="company">Company:</label>
                        <input type="text" id="company" name="company" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email:</label>
                        <input type="email" id="email" name="email">
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone:</label>
                        <input type="tel" id="phone" name="phone">
                    </div>
                    <div class="form-group">
                        <label for="product">Product of Interest:</label>
                        <input type="text" id="product" name="product">
                    </div>
                    <div class="form-group">
                        <label for="stage">Stage:</label>
                        <select id="stage" name="stage" required>
                            <option value="New">New</option>
                            <option value="Qualified">Qualified</option>
                            <option value="Proposal">Proposal</option>
                            <option value="Negotiation">Negotiation</option>
                            <option value="Closed Won">Closed Won</option>
                            <option value="Closed Lost">Closed Lost</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="dateOfContact">Date of Contact:</label>
                        <input type="date" id="dateOfContact" name="dateOfContact" required>
                    </div>
                    <div class="form-group">
                        <label for="followUp">Follow-up Date (Optional):</label>
                        <input type="date" id="followUp" name="followUp">
                    </div>
                    <div class="form-group full-width">
                        <label for="notes">Notes:</label>
                        <textarea id="notes" name="notes" rows="3"></textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Lead</button>
            </form>
        </div>
    </div>

    <!-- Visit Modal (now for Lead Activities) -->
    <div id="visitModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Lead Activity</h2>
                <button class="close-btn" id="closeVisitModalBtn">&times;</button>
            </div>
            <form id="addActivityForm">
                <div class="form-grid">
                    <div class="form-group">
                        <label for="activityDate">Date:</label>
                        <input type="date" id="activityDate" name="activity_date" required>
                    </div>
                    <div class="form-group">
                        <label for="activityType">Activity Type:</label>
                        <select id="activityType" name="activity_type" required>
                            <option value="Call">Call</option>
                            <option value="Email">Email</option>
                            <option value="Meeting">Meeting</option>
                            <option value="Cold Visit">Cold Visit</option>
                            <option value="Demo">Demo</option>
                        </select>
                    </div>
                    <div class="form-group full-width">
                        <label for="activityDescription">Description:</label>
                        <textarea id="activityDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="activityExpenditure">Expenditure (KSh):</label>
                        <input type="number" id="activityExpenditure" name="expenditure" step="0.01" value="0.00">
                    </div>
                    <div class="form-group">
                        <label for="activityLeadId">Link to Lead (Optional):</label>
                        <select id="activityLeadId" name="lead_id">
                            <!-- Options populated by JavaScript -->
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Activity</button>
            </form>
        </div>
    </div>

    <!-- General Expense Modal -->
    <div id="generalExpenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add General Expense</h2>
                <button class="close-btn" id="closeGeneralExpenseModalBtn">&times;</button>
            </div>
            <form id="addExpenseForm">
                <input type="hidden" id="expenseId" name="id"> <!-- Hidden input for expense ID -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="generalExpenseDate">Date:</label>
                        <input type="date" id="generalExpenseDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="generalExpenseAmount">Amount (KSh):</label>
                        <input type="number" id="generalExpenseAmount" name="amount" step="0.01" required>
                    </div>
                    <div class="form-group full-width">
                        <label for="generalExpenseDescription">Description:</label>
                        <textarea id="generalExpenseDescription" name="description" rows="3" required></textarea>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Save Expense</button>
            </form>
        </div>
    </div>

    <!-- General Event Modal (for Calendar Events) -->
    <div id="generalEventModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Add Calendar Event</h2>
                <button class="close-btn" id="closeGeneralEventModalBtn">&times;</button>
            </div>
            <form id="addEventForm">
                <input type="hidden" id="eventId" name="id"> <!-- NEW: Hidden input for event ID -->
                <div class="form-grid">
                    <div class="form-group">
                        <label for="eventDate">Date:</label>
                        <input type="date" id="eventDate" name="date" required>
                    </div>
                    <div class="form-group">
                        <label for="eventType">Event Type:</label>
                        <select id="eventType" name="type" required>
                            <option value="Call">Call</option>
                            <option value="Email">Email</option>
                            <option value="Meeting">Meeting</option>
                            <option value="Cold Visit">Cold Visit</option>
                            <option value="Demo">Demo</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="eventAmount">Amount (KSh):</label>
                        <input type="number" id="eventAmount" name="amount" step="0.01" value="0.00">
                    </div>
                    <div class="form-group full-width">
                        <label for="eventDescription">Description:</label>
                        <textarea id="eventDescription" name="description" rows="3"></textarea>
                    </div>
                    <div class="form-group full-width">
                        <label for="eventLeadId">Link to Lead (Optional):</label>
                        <select id="eventLeadId" name="lead_id">
                        </select>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary">Add Event</button>
            </form>
        </div>
    </div>

    <div id="calendarTooltip" class="calendar-tooltip"></div>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner"></div>
    </div>
    <div id="messageContainer" class="message-container"></div>


    <!-- Local JavaScript for Chart.js from node_modules -->
    <script src="{{ url_for('node_modules_bp.static', filename='chart.js/dist/chart.umd.js') }}"></script>
    <!-- Local JavaScript for FullCalendar from node_modules -->
    <script src='{{ url_for('node_modules_bp.static', filename='@fullcalendar/core/index.global.min.js') }}'></script>
    <script src='{{ url_for('node_modules_bp.static', filename='@fullcalendar/daygrid/index.global.min.js') }}'></script>
    <script src='{{ url_for('node_modules_bp.static', filename='@fullcalendar/interaction/index.global.min.js') }}'></script>
    <!-- Local JavaScript for Flatpickr from node_modules -->
    <script src="{{ url_for('node_modules_bp.static', filename='flatpickr/dist/flatpickr.min.js') }}"></script>

    <!-- Your custom dashboard.js -->
    <script src="{{ url_for('static', filename='dashboard.js') }}"></script>
</body>
</html>
